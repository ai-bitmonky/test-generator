⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217
[dotenv@17.2.3] injecting env (4) from .env.local -- tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] }
🚀 Complete Enrichment Pipeline for Existing Questions

📚 Subject: Chemistry
⏱️  Delay: 6000ms between calls
📊 Max words per field: 100

✨ ALL FEATURES ACTIVE:
   • Question validation (options, answer key, multi-part questions)
   • Completeness verification (no ambiguity, all data provided)
   • Solution verification (matches correct answer)
   • Text enrichment (strategy, expert_insight, key_facts)
   • SVG generation for missing figures
   • 100-word limits with auto-condensing
   • HTML entity cleanup in options
   • Combined word separation
   • Figure warning removal

======================================================================

📥 Fetching questions needing enrichment...

   Total Chemistry questions: 124
   Need enrichment: 47 (37.9%)


[1/47] Processing question 0cd7f7d6...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (3D_DIAGRAM)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[2/47] Processing question 1b537f3f...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Equilibrium diagram)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[3/47] Processing question 2427a722...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Geometric diagram)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[4/47] Processing question 257cd00a...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Molecular)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[5/47] Processing question 2650f255...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (circuit)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[6/47] Processing question 2d84df2c...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Geometric diagram)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[7/47] Processing question 38ab9cbc...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Molecular diagram)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[8/47] Processing question 4000f974...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Molecular diagram)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[9/47] Processing question 412603e3...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Other (step-wise chemical diagram))
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[10/47] Processing question 48b553cd...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Molecular diagram)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

📊 Progress: 10/47 (21.3%)
   Enriched: 10, Failed: 0, Skipped: 0
   Text enriched: 0, SVGs generated: 10


[11/47] Processing question 5821bc9b...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Geometric diagram)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[12/47] Processing question 643b1dd6...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ⚠️  SVG generation failed
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 1 fields

[13/47] Processing question 65cd53ce...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (3D_DIAGRAM)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[14/47] Processing question 67accf6e...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (geometric)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[15/47] Processing question 695cf0ab...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Geometric)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[16/47] Processing question 73a7b26e...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (other)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[17/47] Processing question 758f06c1...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Molecular)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[18/47] Processing question 758fdeb6...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (3D_DIAGRAM)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[19/47] Processing question 80cddb30...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (3D_DIAGRAM)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[20/47] Processing question 818a1f6c...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Other (Conceptual Diagram))
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

📊 Progress: 20/47 (42.6%)
   Enriched: 20, Failed: 0, Skipped: 0
   Text enriched: 0, SVGs generated: 19


[21/47] Processing question 848c49d1...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Molecular)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[22/47] Processing question 849410ca...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Molecular/3D_Diagram)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[23/47] Processing question 85b29b2e...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
   ⚠️  Error, retrying in 15s...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Molecular)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[24/47] Processing question 8937807a...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Geometric)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[25/47] Processing question 8b5d27ec...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (geometric)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[26/47] Processing question 910329b4...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (3D_DIAGRAM)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[27/47] Processing question 95e5690b...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Circuit/Geometric)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[28/47] Processing question a1b0741c...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Geometric)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ❌ Update failed: TypeError: fetch failed

[29/47] Processing question a3728b19...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Molecular diagram)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ❌ Update failed: TypeError: fetch failed

[30/47] Processing question af058ec7...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (circuit)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

📊 Progress: 30/47 (63.8%)
   Enriched: 28, Failed: 2, Skipped: 0
   Text enriched: 0, SVGs generated: 29


[31/47] Processing question c1083611...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Other (Diagram))
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[32/47] Processing question c25d5f79...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Circuit)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[33/47] Processing question c37df8b6...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Geometric)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[34/47] Processing question cb492f13...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Molecular)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[35/47] Processing question cddab138...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Vector diagram)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[36/47] Processing question d646232d...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (2D diagram)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[37/47] Processing question d65165c0...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (geometric)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[38/47] Processing question d75cb169...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (3D_DIAGRAM)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[39/47] Processing question d90f6f93...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Geometric Diagram)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[40/47] Processing question de38d4e4...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Molecular/Chemical Reaction Diagram)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

📊 Progress: 40/47 (85.1%)
   Enriched: 38, Failed: 2, Skipped: 0
   Text enriched: 0, SVGs generated: 39


[41/47] Processing question e2b542c3...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Molecular diagram)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[42/47] Processing question e2e47f31...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (geometric)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[43/47] Processing question eb2e0f5b...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Molecular Diagram)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[44/47] Processing question ed0626da...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (circuit)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[45/47] Processing question edd8a48d...
   🔍 Validating question format...
      ⚠️  Found 1 format issue(s):
         - Multi-part question but options don't address all parts
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Molecular diagram)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[46/47] Processing question f0643972...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Circuit)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

[47/47] Processing question f631e975...
   🔍 Validating question format...
      ✅ Format valid
   🔍 Checking question completeness...
      ✅ Question complete
   🔍 Verifying solution matches answer key...
      ✅ Solution matches answer key
   🎨 Checking for missing figures...
      ✅ SVG generated (Geometric)
   🧹 Removing figure warnings...
      ✅ Warnings removed
   ✅ Updated with 2 fields

======================================================================

✅ Enrichment Complete!

📊 Final Statistics:
   Total processed: 47
   Successfully enriched: 45 (95.7%)
   Text enrichments: 0
   SVGs generated: 46
   Failed: 2 (4.3%)
   Skipped: 0 (0.0%)
